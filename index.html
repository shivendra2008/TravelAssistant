<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Travel Dashboard</title>
        <link rel="stylesheet" href="styles.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    </head>
    <body>
        <div class="container">
            <header class="header">
                <div class="header-text">
                    <h1>Welcome,</h1>   
                    <h2 id="userNameDisplay">Loading...</h2>
                </div>

                

                <p class="search-prompt">Search for your favourite place</p>
                <div class="search-bar">
                    <input type="text" id="cityInput" placeholder="Search here">
                    <button class="search-button" id="searchBtn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </header>

            <main class="main-content">
                <section class="quick-links">
                    <h3>Quick links</h3>
                    <div class="links-grid">
                        <div class="link-item" data-file="weather.html">
                            <div class="link-icon"><i class="fas fa-sun"></i></div>
                            <span>Weather</span>
                        </div>
                        <div class="link-item" data-file="flights.html">
                            <div class="link-icon"><i class="fas fa-plane"></i></div>
                            <span>Flights</span>
                        </div>
                        <div class="link-item" data-file="trains.html">
                            <div class="link-icon"><i class="fas fa-train"></i></div>
                            <span>Trains</span>
                        </div>
                        <div class="link-item" data-file="bus.html">
                            <div class="link-icon"><i class="fas fa-bus"></i></div>
                            <span>Bus</span>
                        </div>
                        <div class="link-item" data-file="hotels.html">
                            <div class="link-icon"><i class="fas fa-hotel"></i></div>
                            <span>Hotel</span>
                        </div>
                    </div>
                </section>

                <section class="also-check">
                    <h3>Also check</h3>
                    <div class="check-list">
                        <button class="check-item travel">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Travel Checklist</span>
                        </button>
                        <button class="check-item category">
                            <i class="fas fa-th-large"></i>
                            <span>Category Wise Destinations</span>
                        </button>
                        <button class="check-item explore">
                            <i class="fas fa-plus-circle"></i>
                            <span>Explore More</span>
                        </button>
                        <button class="check-item settings">
                            <i class="fas fa-cog"></i>
                            <span>Account Settings</span>
                        </button>
                    </div>
                </section>
            </main>
        </div>

        <script type="module">

            /* ------------------- FIREBASE IMPORTS ------------------- */
            // Only importing necessary Firestore modules
            import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
            import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

            /* ------------------- CONFIG ------------------- */
            const hardcodedFirebaseConfig = {
                apiKey: "AIzaSyDtkaHB2ER0RAOpsbW-Eg65wSe7G4Uwrkw",
                authDomain: "travelassistant-1baed.firebaseapp.com",
                projectId: "travelassistant-1baed",
                storageBucket: "travelassistant-1baed.firebasestorage.app",
                messagingSenderId: "67570490262",
                appId: "1:67570490262:web:7164a2d838b5517a325bb7"
            };
            const appId = "travelassistant-1baed";
            const firebaseConfig = hardcodedFirebaseConfig;

            /* ------------------- INITIALIZE FIREBASE ------------------- */
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            /* ------------------- USER NAME DISPLAY LOGIC (FIXED) ------------------- */
            const nameEl = document.getElementById("userNameDisplay"); 

            function loadUserName() {
                const userUid = localStorage.getItem('userUid');
                const userEmail = localStorage.getItem('userEmail');

                if (!userUid || !userEmail) {
                    nameEl.textContent = "Guest";
                    return;
                }

                const profileRef = doc(db, "artifacts", appId, "users", userUid, "profile", "data");
                
                getDoc(profileRef)
                    .then(snap => {
                        let displayedName = userEmail.split("@")[0]; // Default to email prefix
                        if (snap.exists()) {
                            const fetchedName = snap.data().name; 
                            displayedName = fetchedName || userEmail.split("@")[0];
                        }
                        nameEl.textContent = displayedName;
                    })
                    .catch(e => {
                        console.error("Error loading profile:", e);
                        nameEl.textContent = "Traveler";
                    });
            }

            loadUserName();

            /* ------------------- NAVIGATION (CLEANED) ------------------- */

            document.getElementById("searchBtn").addEventListener("click", function() {
                const city = document.getElementById("cityInput").value;

                if (city.trim() !== "") {
                    window.location.href = `search.html?city=${encodeURIComponent(city.trim())}`;
                } else {
                    alert("Please enter a city name to search.");
                }
            });

            document.querySelectorAll(".links-grid .link-item").forEach(item => {
                item.addEventListener("click", function() {
                    const file = this.getAttribute("data-file");
                    if (file) window.location.href = file;
                });
            });

            document.getElementById("cityInput").addEventListener("keydown", function(event) {
                if (event.key === "Enter") {
                    document.getElementById("searchBtn").click();
                }
            });
            
         
            // Navigate to Category Wise Destinations
document.querySelector('.check-item.category').addEventListener('click', function() {
    window.location.href = 'destinations.html';
});
// Navigate to Category Wise Destinations
document.querySelector('.check-item.travel').addEventListener('click', function() {
    window.location.href = 'travel-checklist.html';
});
document.querySelector('.check-item.settings').addEventListener('click', function() {
    window.location.href = 'profile.html';
});
        </script>
    </body>
    </html>