<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-text">
                <h1>Welcome,</h1>
                <h2 id="userNameDisplay">Loading...</h2>
            </div>
            <div class="profile-icon">
                <i class="fas fa-user-circle"></i>
            </div>

            

            <p class="search-prompt">Search for your favourite place</p>
            <div class="search-bar">
                <input type="text" id="cityInput" placeholder="Search here">
                <button class="search-button" id="searchBtn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </header>

        <main class="main-content">
            <section class="quick-links">
                <h3>Quick links</h3>
                <div class="links-grid">
                    <div class="link-item" data-file="weather.html">
                        <div class="link-icon"><i class="fas fa-sun"></i></div>
                        <span>Weather</span>
                    </div>
                    <div class="link-item" data-file="flights.html">
                        <div class="link-icon"><i class="fas fa-plane"></i></div>
                        <span>Flights</span>
                    </div>
                    <div class="link-item" data-file="trains.html">
                        <div class="link-icon"><i class="fas fa-train"></i></div>
                        <span>Trains</span>
                    </div>
                    <div class="link-item" data-file="bus.html">
                        <div class="link-icon"><i class="fas fa-bus"></i></div>
                        <span>Bus</span>
                    </div>
                    <div class="link-item" data-file="hotels.html">
                        <div class="link-icon"><i class="fas fa-hotel"></i></div>
                        <span>Hotel</span>
                    </div>
                </div>
            </section>

            <section class="also-check">
                <h3>Also check</h3>
                <div class="check-list">
                    <button class="check-item travel">
                        <i class="fas fa-clipboard-list"></i>
                        <span>Travel Checklist</span>
                    </button>
                    <button class="check-item category">
                        <i class="fas fa-th-large"></i>
                        <span>Category Wise Destinations</span>
                    </button>
                    <button class="check-item explore">
                        <i class="fas fa-plus-circle"></i>
                        <span>Explore More</span>
                    </button>
                    <button class="check-item settings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script type="module">

        /* ------------------- FIXED FIREBASE IMPORTS ------------------- */

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        import { 
            getAuth, 
            signInWithCustomToken, 
            signInAnonymously, 
            onAuthStateChanged,
            signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        import { 
            getFirestore, 
            doc, 
            getDoc
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";


        /* ------------------- FIXED CONFIG (NEVER NULL) ------------------- */

        const hardcodedFirebaseConfig = {
            apiKey: "AIzaSyDtkaHB2ER0RAOpsbW-Eg65wSe7G4Uwrkw",
            authDomain: "travelassistant-1baed.firebaseapp.com",
            projectId: "travelassistant-1baed",
            storageBucket: "travelassistant-1baed.firebasestorage.app",
            messagingSenderId: "67570490262",
            appId: "1:67570490262:web:7164a2d838b5517a325bb7"
        };

        const appId = typeof __app_id !== "undefined" ? __app_id : "travelassistant-1baed";
        const firebaseConfig = typeof __firebase_config !== "undefined"
            ? JSON.parse(__firebase_config)
            : hardcodedFirebaseConfig;

        const initialAuthToken = typeof __initial_auth_token !== "undefined" 
            ? __initial_auth_token 
            : null;


        /* ------------------- INITIALIZE FIREBASE ------------------- */

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);


        /* ------------------- USER NAME DISPLAY ------------------- */

        onAuthStateChanged(auth, async (user) => {
            const nameEl = document.getElementById("userNameDisplay");

            if (!user) {
                nameEl.textContent = "Guest";
                return;
            }

            const profileRef = doc(db, "artifacts", appId, "users", user.uid, "profile", "data");

            try {
                const snap = await getDoc(profileRef);
                if (snap.exists()) {
                    nameEl.textContent = snap.data().name || user.email;
                } else {
                    nameEl.textContent = user.email || "Traveler";
                }
            } catch (e) {
                console.error(e);
                nameEl.textContent = "Traveler";
            }
        });


        /* ------------------- LOGOUT BUTTON ------------------- */

        onAuthStateChanged(auth, () => {
            const btn = document.getElementById("logoutBtn");
            btn.onclick = async () => {
                try {
                    await signOut(auth);
                    window.location.href = "login.html";
                } catch (err) {
                    alert("Logout failed");
                }
            };
        });


        /* ------------------- SEARCH & LINKS (UNCHANGED) ------------------- */

        document.getElementById("searchBtn").addEventListener("click", function() {
            const city = document.getElementById("cityInput").value;

            if (city.trim() !== "") {
                window.location.href = `search.html?city=${encodeURIComponent(city.trim())}`;
            } else {
                alert("Please enter a city name to search.");
            }
        });

        document.querySelectorAll(".links-grid .link-item").forEach(item => {
            item.addEventListener("click", function() {
                const file = this.getAttribute("data-file");
                if (file) window.location.href = file;
            });
        });

        document.getElementById("cityInput").addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
                document.getElementById("searchBtn").click();
            }
        });
     document.querySelector('.profile-icon').addEventListener('click', () => {
    window.location.href = 'profile.html';
});
    </script>
</body>
</html>
